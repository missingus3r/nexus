<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <meta name="description" content="Muro de donadores de Vortex: Agradecemos a todos los que apoyan el desarrollo de la plataforma.">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <%- include('partials/theme-init') %>
    <link rel="stylesheet" href="/css/donadores.css">
</head>
<body>
    <div class="page">
        <div class="glow one"></div>
        <div class="glow two"></div>

        <header>
            <div class="brand">VORTEX</div>
            <div class="platform-nav">
                <!-- Menu hamburguesa siempre visible -->
                <div class="hamburger-menu">
                    <button class="hamburger-btn" id="hamburgerBtn" aria-label="Men√∫ de navegaci√≥n" aria-expanded="false">
                        <span class="hamburger-icon">‚ò∞</span>
                    </button>
                    <nav class="dropdown-menu" id="dropdownMenu" aria-label="Navegaci√≥n principal">
                        <a href="/">Inicio</a>
                        <a href="/plataforma">Plataforma</a>
                        <a href="/centinel">Centinel</a>
                        <a href="/forum">Foro</a>
                        <a href="/surlink">Surlink</a>
                        <a href="/social">Social</a>
                        <a href="/nexus">Nexus</a>
                        <a href="/pricing">Pricing</a>
                        <a href="/donadores" aria-current="page" class="active">Donadores</a>
                        <% if (typeof isAuthenticated !== 'undefined' && isAuthenticated) { %>
                            <a href="/dashboard">Dashboard</a>
                            <a href="/auth/logout">Cerrar sesi√≥n</a>
                        <% } else { %>
                            <a href="/login">Iniciar sesi√≥n</a>
                        <% } %>
                    </nav>
                </div>
            </div>
        </header>

        <main>
            <!-- Hero Section -->
            <section class="hero">
                <div class="hero-content">
                    <h1 class="hero-title">‚ù§Ô∏è Muro de Donadores</h1>
                    <p class="hero-text">
                        Gracias a cada persona que ha contribuido al desarrollo de Vortex.
                        Su apoyo hace posible que esta plataforma siga creciendo y mejorando.
                    </p>
                    <p class="hero-text">
                        <strong>Vortex es un proyecto open-source</strong> que busca centralizar informaci√≥n
                        cr√≠tica y facilitar el acceso a servicios esenciales. Cada donaci√≥n nos ayuda a
                        mantener los servidores, desarrollar nuevas funcionalidades y seguir ofreciendo
                        un servicio gratuito y de calidad para toda la comunidad.
                    </p>
                    <p class="hero-text" style="color: rgba(124, 92, 255, 0.9); font-weight: 500; font-size: 0.95rem;">
                        Este muro se actualiza semanalmente con los nuevos donadores y suscriptores Premium.
                    </p>
                    <div class="hero-actions">
                        <a class="cta primary" href="https://paypal.me/xplice?locale.x=es_XC&country.x=UY" target="_blank" rel="noopener noreferrer">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5"></path>
                                <path d="M2 12l10 5 10-5"></path>
                            </svg>
                            Donar con PayPal
                        </a>
                        <a class="cta secondary" href="/pricing">Ver planes</a>
                    </div>
                </div>
            </section>

            <!-- Donors Section -->
            <section class="donors-section">
                <h2 class="section-title">Nuestros Donadores</h2>
                <p class="section-subtitle">Agradecemos enormemente a cada persona que ha contribuido al proyecto</p>

                <div class="donors-grid" id="donorsGrid">
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary); grid-column: 1 / -1;">
                        Cargando donadores...
                    </div>
                </div>
            </section>

            <!-- Impact Section -->
            <section class="impact-section">
                <h2 class="section-title">El Impacto de tu Donaci√≥n</h2>
                <div class="impact-grid">
                    <div class="impact-card">
                        <div class="impact-icon">üöÄ</div>
                        <h3>Desarrollo Continuo</h3>
                        <p>Las donaciones nos permiten dedicar m√°s tiempo al desarrollo de nuevas funcionalidades y mejoras.</p>
                    </div>
                    <div class="impact-card">
                        <div class="impact-icon">üåê</div>
                        <h3>Infraestructura</h3>
                        <p>Mantenemos los servidores funcionando 24/7 para que siempre tengas acceso a la plataforma.</p>
                    </div>
                    <div class="impact-card">
                        <div class="impact-icon">üÜì</div>
                        <h3>Servicio Gratuito</h3>
                        <p>Tu aporte ayuda a que Vortex siga siendo gratuito y accesible para toda la comunidad.</p>
                    </div>
                    <div class="impact-card">
                        <div class="impact-icon">üí°</div>
                        <h3>Innovaci√≥n</h3>
                        <p>Nos permite experimentar con nuevas tecnolog√≠as como IA y an√°lisis de datos para mejorar la plataforma.</p>
                    </div>
                </div>
            </section>

            <!-- CTA Section -->
            <section class="cta-section">
                <h2>¬øQuieres Formar Parte?</h2>
                <p>Tu contribuci√≥n, sin importar el monto, hace la diferencia. √önete a nuestra comunidad de donadores y ayuda a que Vortex siga creciendo.</p>
                <div class="cta-buttons">
                    <a href="https://paypal.me/xplice?locale.x=es_XC&country.x=UY" target="_blank" rel="noopener noreferrer" class="btn-cta primary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                            <path d="M2 17l10 5 10-5"></path>
                            <path d="M2 12l10 5 10-5"></path>
                        </svg>
                        Donar Ahora
                    </a>
                    <a href="/pricing" class="btn-cta secondary">Ver Planes de Suscripci√≥n</a>
                </div>
            </section>
        </main>

        <footer>
            <span>¬© <%= new Date().getFullYear() %> Vortex, una empresa de <a href="https://dokta.cc/" target="_blank" rel="noopener noreferrer">DOKTA</a>. Dise√±ado en Uruguay con üíô.</span>
            <nav aria-label="Enlaces legales">
                <a href="/privacy">Privacidad</a> ¬∑
                <a href="/terms">T√©rminos</a> ¬∑
                <a href="mailto:contacto@vortex.uy?subject=Contacto desde Vortex&body=Hola, me gustar√≠a ponerme en contacto con ustedes para...">Contacto</a>
            </nav>
        </footer>
    </div>

    <script src="/js/social.js"></script>
    <script>
        // Load donors from API
        async function loadDonors() {
            const grid = document.getElementById('donorsGrid');

            if (!grid) return;

            try {
                const response = await fetch('/api/donors');
                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'Error al cargar donadores');
                }

                displayDonors(data.donors || []);
            } catch (error) {
                console.error('Error loading donors:', error);
                grid.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--danger-color); grid-column: 1 / -1;">
                        Error al cargar donadores. Por favor, intenta nuevamente m√°s tarde.
                    </div>
                `;
            }
        }

        function displayDonors(donors) {
            const grid = document.getElementById('donorsGrid');

            if (!grid) return;

            if (!donors || donors.length === 0) {
                grid.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary); grid-column: 1 / -1;">
                        A√∫n no hay donadores registrados. ¬°S√© el primero en contribuir!
                    </div>
                `;
                return;
            }

            const tierBadges = {
                platinum: { label: 'Platino', icon: 'üíé' },
                gold: { label: 'Oro', icon: '‚≠ê‚≠ê‚≠ê' },
                silver: { label: 'Plata', icon: '‚≠ê‚≠ê' },
                bronze: { label: 'Bronce', icon: '‚≠ê' }
            };

            const donorCards = donors.map(donor => {
                const badge = tierBadges[donor.tier] || tierBadges.bronze;
                const messageHTML = donor.message
                    ? `<p class="donor-message">"${donor.message}"</p>`
                    : '';

                // Use "Donador An√≥nimo" if isAnonymous is true
                const displayName = donor.isAnonymous ? 'Donador An√≥nimo' : donor.name;

                return `
                    <div class="donor-card ${donor.tier}">
                        <div class="donor-badge">
                            <span class="badge-icon">${badge.icon}</span>
                            <span class="badge-label">${badge.label}</span>
                        </div>
                        <div class="donor-info">
                            <h3 class="donor-name">${displayName}</h3>
                            <p class="donor-amount">$${donor.amount} ${donor.currency || 'USD'}</p>
                            <p class="donor-date">${donor.date}</p>
                            ${messageHTML}
                        </div>
                    </div>
                `;
            }).join('');

            grid.innerHTML = donorCards;
        }

        // Init on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Hamburger menu functionality
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const dropdownMenu = document.getElementById('dropdownMenu');

            if (hamburgerBtn && dropdownMenu) {
                // Toggle menu on button click
                hamburgerBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isActive = dropdownMenu.classList.toggle('active');
                    hamburgerBtn.setAttribute('aria-expanded', isActive);
                });

                // Close menu when clicking outside
                document.addEventListener('click', function(e) {
                    if (!hamburgerBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
                        dropdownMenu.classList.remove('active');
                        hamburgerBtn.setAttribute('aria-expanded', 'false');
                    }
                });

                // Close menu when clicking on a menu item
                dropdownMenu.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', function() {
                        dropdownMenu.classList.remove('active');
                        hamburgerBtn.setAttribute('aria-expanded', 'false');
                    });
                });

                // Close menu on ESC key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && dropdownMenu.classList.contains('active')) {
                        dropdownMenu.classList.remove('active');
                        hamburgerBtn.setAttribute('aria-expanded', 'false');
                        hamburgerBtn.focus();
                    }
                });
            }

            // Logout handler - simplificado
            const logoutLinks = document.querySelectorAll('a[href="/auth/logout"]');
            logoutLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    localStorage.clear();
                    sessionStorage.clear();
                    window.location.href = '/auth/logout';
                });
            });

            // Load donors on page load
            loadDonors();
        });
    </script>
</body>
</html>
