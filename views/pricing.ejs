<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <%- include('partials/theme-init') %>
    <link rel="stylesheet" href="/css/pricing.css">
</head>
<body>
    <div class="page">
        <div class="glow one"></div>
        <div class="glow two"></div>

        <header>
            <div class="brand">VORTEX</div>
            <div class="platform-nav">
                <button class="hamburger" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <nav>
                    <a href="/">Inicio</a>
                    <a href="/plataforma">Plataforma</a>
                    <a href="/centinel">Centinel</a>
                    <a href="/forum">Foro</a>
                    <a href="/surlink">Surlink</a>
                    <a href="/social">Social</a>
                    <a href="/nexus">Nexus</a>
                    <a href="/pricing" aria-current="page" class="active">Pricing</a>
                    <% if (isAuthenticated) { %>
                        <a href="/logout">Cerrar sesi√≥n</a>
                    <% } else { %>
                        <a href="/login">Iniciar sesi√≥n</a>
                    <% } %>
                </nav>
            </div>
        </header>

        <div class="pricing-container">
            <!-- Hero Section -->
            <div class="pricing-hero">
                <h1>Elige el plan perfecto para ti</h1>
                <p>Desde seguimiento de seguridad personal hasta soluciones profesionales completas</p>

                <!-- Billing Cycle Toggle -->
                <div class="billing-toggle">
                    <span class="toggle-label" id="monthlyLabel">Mensual</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="billingToggle">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label" id="yearlyLabel">Anual <span class="discount-badge">10% OFF</span></span>
                </div>
            </div>

            <!-- Personal Plans -->
            <section class="plans-section">
                <h2 class="section-title">Planes Personales</h2>
                <div class="plans-grid">
                    <!-- Free Plan -->
                    <div class="plan-card">
                        <div class="plan-header">
                            <h3>Free</h3>
                            <p class="plan-description">Perfecto para comenzar a explorar Vortex</p>
                        </div>
                        <div class="plan-price">
                            <div class="price-wrapper">
                                <span class="currency">$</span>
                                <span class="amount">0</span>
                                <span class="period">/mes</span>
                            </div>
                            <div class="price-secondary">$0 UYU</div>
                        </div>
                        <ul class="plan-features">
                            <li class="feature-item">‚úì Hasta 5 reportes de incidentes al mes</li>
                            <li class="feature-item">‚úì Acceso al mapa en tiempo real</li>
                            <li class="feature-item">‚úì Visualizaci√≥n de noticias geolocalizadas</li>
                            <li class="feature-item">‚úì Navegaci√≥n de Surlink (solo b√∫squeda)</li>
                            <li class="feature-item">‚úì Acceso al foro comunitario</li>
                        </ul>
                        <a href="/login" class="btn-plan">Comenzar Gratis</a>
                    </div>

                    <!-- Premium Plan -->
                    <div class="plan-card popular">
                        <div class="popular-badge">M√ÅS POPULAR</div>
                        <div class="plan-header">
                            <h3>Premium</h3>
                            <p class="plan-description">Para usuarios que quieren el m√°ximo potencial</p>
                        </div>
                        <div class="plan-price">
                            <div class="price-wrapper">
                                <span class="currency">$</span>
                                <span class="amount" data-monthly="5" data-yearly="54">5</span>
                                <span class="period">/mes</span>
                            </div>
                            <div class="price-secondary" data-monthly="$220 UYU" data-yearly="$2,376 UYU">$220 UYU</div>
                        </div>
                        <ul class="plan-features">
                            <li class="feature-item">‚úì Reportes ilimitados de incidentes</li>
                            <li class="feature-item">‚úì Publicaciones en Surlink (casas o autos)</li>
                            <li class="feature-item">‚úì Acceso a la API REST</li>
                            <li class="feature-item">‚úì Exportaci√≥n de datos (PDF/Excel)</li>
                            <li class="feature-item">‚úì Chatbot IA con GPT-5 para b√∫squeda inteligente</li>
                            <li class="feature-item">‚úì Soporte prioritario</li>
                            <li class="feature-item">‚úì Acceso anticipado a nuevas funcionalidades</li>
                            <li class="feature-item">‚úì Aparici√≥n en el <a href="/donadores" style="color: #10c6ff; text-decoration: underline;">muro de donadores</a></li>
                            <li class="feature-item">‚úì Todo lo del plan Free</li>
                        </ul>
                        <a href="mailto:info.vortexlabs@protonmail.com?subject=Consulta%20Plan%20Premium&body=Hola,%0A%0AMe%20gustar%C3%ADa%20contratar%20el%20plan%20Premium%20($5%20USD%20%2F%20$220%20UYU%20al%20mes).%0A%0ANombre:%20%0AEmail:%20%0ATel%C3%A9fono:%20%0A%0AGracias." class="btn-plan btn-primary">Contactar</a>
                    </div>

                    <!-- Donation Card -->
                    <div class="plan-card donation-card">
                        <div class="plan-header">
                            <h3>Donar al Proyecto</h3>
                            <p class="plan-description">Apoya el desarrollo de Vortex</p>
                        </div>
                        <div class="donation-content">
                            <p style="color: var(--text-muted); line-height: 1.7; margin-bottom: 1.5rem;">
                                ¬øPrefieres hacer una donaci√≥n √∫nica? Si no quieres pagar de forma mensual, puedes realizar una donaci√≥n an√≥nima o bajo tu usuario.
                                <strong style="color: var(--text-primary);">Aparecer√°s en nuestro <a href="/donadores">muro de donadores</a></strong> (actualizado semanalmente).
                            </p>
                        </div>
                        <ul class="plan-features">
                            <li class="feature-item">‚úì Donaci√≥n √∫nica sin compromisos</li>
                            <li class="feature-item">‚úì Aparici√≥n en el <a href="/donadores">muro de donadores</a></li>
                            <li class="feature-item">‚úì Puedes donar de forma an√≥nima</li>
                            <li class="feature-item">‚úì Apoyas el proyecto open-source</li>
                        </ul>
                        <a href="https://paypal.me/xplice?locale.x=es_XC&country.x=UY" target="_blank" rel="noopener noreferrer" class="btn-plan btn-donation">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5"></path>
                                <path d="M2 12l10 5 10-5"></path>
                            </svg>
                            Donar con PayPal
                        </a>
                    </div>
                </div>
            </section>

            <!-- FAQ Section -->
            <section class="faq-section">
                <h2 class="section-title">Preguntas Frecuentes</h2>
                <div class="faq-grid">
                    <div class="faq-item">
                        <h3>¬øPuedo usar la plataforma sin pagar ni registrarme?</h3>
                        <p>S√≠, puedes acceder y explorar muchas funciones de Vortex sin pagar ni crear una cuenta. Solo necesitas registrarte si quieres publicar o acceder a herramientas avanzadas.</p>
                    </div>
                    <div class="faq-item">
                        <h3>¬øPuedo cambiar de plan en cualquier momento?</h3>
                        <p>S√≠, puedes actualizar o cambiar tu plan en cualquier momento. Los cambios se aplicar√°n inmediatamente.</p>
                    </div>
                    <div class="faq-item">
                        <h3>¬øQu√© m√©todos de pago aceptan?</h3>
                        <p>Aceptamos transferencias bancarias, tarjetas de cr√©dito/d√©bito, y MercadoPago. Cont√°ctanos para coordinar el m√©todo que prefieras.</p>
                    </div>
                    <div class="faq-item">
                        <h3>¬øHay descuento por pago anual?</h3>
                        <p>S√≠, ofrecemos un 10% de descuento en todos los planes si pagas anualmente.</p>
                    </div>
                    <div class="faq-item">
                        <h3>¬øPuedo cancelar mi suscripci√≥n?</h3>
                        <p>Por supuesto. Puedes cancelar tu suscripci√≥n en cualquier momento sin penalizaciones. Tendr√°s acceso hasta el final del per√≠odo pagado.</p>
                    </div>
                    <div class="faq-item">
                        <h3>¬øLos planes incluyen soporte?</h3>
                        <p>El plan Premium incluye soporte prioritario v√≠a email. Todos los usuarios pueden contactarnos para consultas generales.</p>
                    </div>
                </div>
            </section>

            <!-- CTA Section -->
            <section class="cta-section">
                <h2>¬øTienes dudas? Cont√°ctanos</h2>
                <p>Nuestro equipo est√° listo para ayudarte a elegir el mejor plan para tus necesidades</p>
                <a href="mailto:info.vortexlabs@protonmail.com" class="btn-cta">Pregunta aqu√≠ lo que quieras</a>
            </section>
        </div>

        <footer>
            <span>¬© <%= new Date().getFullYear() %> Vortex, una empresa de <a href="https://dokta.cc/" target="_blank" rel="noopener noreferrer">DOKTA</a>. Dise√±ado en Uruguay con üíô.</span>
            <span>
                <a href="/privacy">Privacidad</a> ¬∑
                <a href="/terms">T√©rminos</a>
            </span>
        </footer>
    </div>

    <script>
    let pricingData = null;

    // Load pricing settings from API
    async function loadPricing() {
        try {
            const response = await fetch('/api/pricing/settings');
            const data = await response.json();

            if (data.success) {
                pricingData = data.pricing;
                updatePrices();
            }
        } catch (error) {
            console.error('Error loading pricing:', error);
        }
    }

    // Update prices in the UI
    function updatePrices() {
        if (!pricingData) return;

        const usdToUyu = pricingData.usdToUyu;
        const isYearly = document.getElementById('billingToggle').checked;

        // Premium (now $5 plan - using 'pro' data from API for backward compatibility)
        updatePlanPrice('premium', pricingData.plans.pro, usdToUyu, isYearly);
    }

    function updatePlanPrice(planClass, planData, usdToUyu, isYearly) {
        const priceUSD = isYearly ? planData.yearly : planData.monthly;

        // Map plan classes to their initial monthly values for identification
        const planIdentifiers = {
            'premium': '5'  // Now Premium is the $5 plan
        };

        // Find the plan card
        const amounts = document.querySelectorAll('.amount[data-yearly]');
        amounts.forEach(amount => {
            if (amount.dataset.monthly === planIdentifiers[planClass]) {
                // Update data attributes
                amount.dataset.monthly = planData.monthly;
                amount.dataset.yearly = planData.yearly;

                // Update displayed price
                amount.textContent = priceUSD;

                // Update UYU price
                const priceSecondary = amount.closest('.plan-price').querySelector('.price-secondary');
                if (priceSecondary) {
                    const monthlyUYU = Math.round(planData.monthly * usdToUyu);
                    const yearlyUYU = Math.round(planData.yearly * usdToUyu);

                    priceSecondary.dataset.monthly = `$${monthlyUYU.toLocaleString('es-UY')} UYU`;
                    priceSecondary.dataset.yearly = `$${yearlyUYU.toLocaleString('es-UY')} UYU`;
                    priceSecondary.textContent = isYearly ? priceSecondary.dataset.yearly : priceSecondary.dataset.monthly;
                }
            }
        });
    }

    // Billing cycle toggle functionality
    const billingToggle = document.getElementById('billingToggle');
    const amounts = document.querySelectorAll('.amount[data-yearly]');
    const secondaryPrices = document.querySelectorAll('.price-secondary[data-yearly]');

    billingToggle.addEventListener('change', function() {
        const isYearly = this.checked;

        if (pricingData) {
            updatePrices();
        } else {
            // Fallback to hardcoded prices if API fails
            amounts.forEach(amount => {
                const monthlyPrice = amount.dataset.monthly;
                const yearlyPrice = amount.dataset.yearly;
                amount.textContent = isYearly ? yearlyPrice : monthlyPrice;
            });

            secondaryPrices.forEach(price => {
                const monthlyPrice = price.dataset.monthly;
                const yearlyPrice = price.dataset.yearly;
                price.textContent = isYearly ? yearlyPrice : monthlyPrice;
            });
        }

        // Update period text
        const periods = document.querySelectorAll('.period');
        periods.forEach(period => {
            period.textContent = isYearly ? '/a√±o' : '/mes';
        });
    });

    // Load pricing on page load
    document.addEventListener('DOMContentLoaded', loadPricing);

    // Hamburger menu functionality
    const hamburger = document.querySelector('.hamburger');
    const nav = document.querySelector('.platform-nav nav');

    if (hamburger && nav) {
        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            nav.classList.toggle('active');
        });

        // Close menu when clicking on a link
        const navLinks = document.querySelectorAll('.platform-nav nav a');
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                hamburger.classList.remove('active');
                nav.classList.remove('active');
            });
        });

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.platform-nav') && nav.classList.contains('active')) {
                hamburger.classList.remove('active');
                nav.classList.remove('active');
            }
        });
    }

    // Logout handler - simplificado
    const logoutLinks = document.querySelectorAll('a[href="/logout"]');
    logoutLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.clear();
            sessionStorage.clear();
            window.location.href = '/logout';
        });
    });
    </script>
</body>
</html>
