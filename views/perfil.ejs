<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <%- include('partials/theme-init') %>
    <link rel="stylesheet" href="/css/style.css">
    <script src="/js/theme-toggle.js" defer></script>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/perfil.css">
</head>
</head>
<body>
    <%- include('partials/header-perfil', { page: page, isAuthenticated: isAuthenticated }) %>

    <div class="main-content">
        <div class="container">
            <div class="profile-container">
                <!-- Profile Header -->
                <div class="profile-header">
                    <div class="profile-avatar" id="userAvatar">
                        üë§
                    </div>
                    <div class="profile-info">
                        <h1 id="userName">Cargando...</h1>
                        <p id="userEmail">email@example.com</p>
                        <p>Miembro desde: <span id="memberSince">-</span></p>
                        <div>
                            <span class="profile-badge" id="userRole">Usuario</span>
                            <span class="subscription-badge" id="userSubscription">Free</span>
                        </div>
                    </div>
                </div>

                <!-- Upgrade Section (only shown for free users) -->
                <div id="upgradeSection" class="upgrade-section" style="display: none;">
                    <h3>Desbloquea todo el potencial de VORTEX</h3>
                    <p>Accede a reportes ilimitados, alertas personalizadas, datos hist√≥ricos y mucho m√°s con nuestros planes premium.</p>
                    <a href="/pricing" class="btn">Ver Planes y Precios</a>
                </div>

                <!-- CENTINEL SECTION -->
                <div class="platform-section">
                    <div class="platform-section-header">
                        <div class="platform-icon centinel-icon">üõ°Ô∏è</div>
                        <h2>VORTEX Centinel</h2>
                    </div>

                    <!-- Centinel Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="number" id="totalReports">0</div>
                            <div class="label">Reportes</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="totalValidations">0</div>
                            <div class="label">Validaciones</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="reputationScore">0</div>
                            <div class="label">Reputaci√≥n</div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <h3 style="margin-bottom: 1rem; color: #333;">Actividad Reciente</h3>
                    <div class="activity-list" id="recentActivity">
                        <div class="empty-state">
                            <p>Cargando actividad...</p>
                        </div>
                    </div>
                </div>

                <!-- SURLINK SECTION -->
                <div class="platform-section">
                    <div class="platform-section-header">
                        <div class="platform-icon surlink-icon">üîó</div>
                        <h2>VORTEX Surlink</h2>
                    </div>

                    <div class="surlink-grid">
                        <div class="surlink-card" onclick="openFavoritesModal()">
                            <div class="surlink-card-icon">‚≠ê</div>
                            <div class="surlink-card-title">Favoritos</div>
                            <div class="surlink-card-count" id="favoritesCount">0</div>
                            <div class="surlink-card-label">Listados guardados</div>
                        </div>

                        <div class="surlink-card" onclick="openCommentsModal()">
                            <div class="surlink-card-icon">üí¨</div>
                            <div class="surlink-card-title">Comentarios</div>
                            <div class="surlink-card-count" id="commentsCount">0</div>
                            <div class="surlink-card-label">Comentarios realizados</div>
                        </div>

                        <div class="surlink-card" onclick="openResponsesModal()">
                            <div class="surlink-card-icon">‚Ü©Ô∏è</div>
                            <div class="surlink-card-title">Respuestas</div>
                            <div class="surlink-card-count" id="responsesCount">0</div>
                            <div class="surlink-card-label">Respuestas recibidas</div>
                        </div>
                    </div>
                </div>

                <!-- FORUM SECTION -->
                <div class="platform-section">
                    <div class="platform-section-header">
                        <div class="platform-icon forum-icon">üí¨</div>
                        <h2>VORTEX Forums</h2>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="number" id="forumThreadsCount">0</div>
                            <div class="label">Hilos creados</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="forumCommentsCount">0</div>
                            <div class="label">Comentarios publicados</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="forumRepliesCount">0</div>
                            <div class="label">Respuestas recibidas</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="forumLikesCount">0</div>
                            <div class="label">Reacciones acumuladas</div>
                        </div>
                    </div>

                    <div class="forum-columns">
                        <div class="forum-column">
                            <div class="forum-column-header">
                                <h3>Mis √∫ltimos hilos</h3>
                                <a href="/forum-vortex" class="forum-link-btn">Nuevo hilo</a>
                            </div>
                            <div class="activity-list" id="forumThreadsList">
                                <div class="empty-state">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                    <p>Todav√≠a no creaste hilos.</p>
                                </div>
                            </div>
                        </div>
                        <div class="forum-column">
                            <div class="forum-column-header">
                                <h3>Mis √∫ltimos comentarios</h3>
                                <a href="/forum" class="forum-link-btn">Explorar foro</a>
                            </div>
                            <div class="activity-list" id="forumCommentsList">
                                <div class="empty-state">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                    <p>Todav√≠a no comentaste en el foro.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CONFIGURACI√ìN -->
                <div class="platform-section">
                    <h2 style="margin-bottom: 1.5rem; color: #333;">‚öôÔ∏è Configuraci√≥n</h2>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="emailNotifications">
                            <span>Recibir notificaciones por email</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="publicProfile">
                            <span>Perfil p√∫blico</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="showLocation">
                            <span>Mostrar ubicaci√≥n en reportes</span>
                        </label>
                    </div>
                </div>

                <!-- ACCIONES DE CUENTA -->
                <div class="platform-section">
                    <h2 style="margin-bottom: 1.5rem; color: #333;">üîß Acciones de Cuenta</h2>

                    <!-- Profile Picture Actions -->
                    <div style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid #e0e0e0;">
                        <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: #555;">Foto de Perfil</h3>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button id="uploadPhotoBtn" class="btn btn-primary">
                                üì∑ Cambiar Foto
                            </button>
                            <button id="removePhotoBtn" class="btn btn-secondary" style="display: none;">
                                üóëÔ∏è Eliminar Foto
                            </button>
                        </div>
                    </div>

                    <!-- Account Actions -->
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <a href="/logout" class="btn btn-secondary">Cerrar Sesi√≥n</a>
                        <% if (user && user.role === 'admin') { %>
                            <a href="/admin" class="btn btn-primary">Panel de Admin</a>
                        <% } %>
                    </div>
                </div>

                <!-- DANGER ZONE -->
                <div class="platform-section danger-zone">
                    <h2 style="margin-bottom: 1rem; color: #dc3545; border-bottom-color: #dc3545;">‚ö†Ô∏è Zona de Peligro</h2>
                    <p style="color: #666; margin-bottom: 1.5rem;">
                        Las acciones en esta secci√≥n son irreversibles. Procede con precauci√≥n.
                    </p>
                    <button id="deleteAccountBtn" class="btn btn-danger">
                        üóëÔ∏è Eliminar Cuenta Permanentemente
                    </button>
                    <p style="font-size: 0.875rem; color: #666; margin-top: 0.75rem;">
                        Esta acci√≥n eliminar√° todos tus datos, reportes y actividad. No se puede deshacer.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Account Confirmation Modal -->
    <div id="deleteAccountModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>‚ö†Ô∏è Confirmar Eliminaci√≥n</h2>
                <button id="closeDeleteModal" class="modal-close">&times;</button>
            </div>
            <div style="padding: 1rem 0;">
                <p style="margin-bottom: 1rem;">
                    ¬øEst√°s seguro que deseas eliminar tu cuenta <strong id="deleteUsername">username</strong>?
                </p>
                <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin-bottom: 1rem; border-radius: 4px;">
                    <strong>‚ö†Ô∏è Esta acci√≥n es permanente e irreversible.</strong>
                    <ul style="margin: 0.5rem 0 0 1.5rem;">
                        <li>Se eliminar√°n todos tus reportes</li>
                        <li>Se perder√° tu historial de actividad</li>
                        <li>Se borrar√°n tus validaciones</li>
                        <li>No podr√°s recuperar tu cuenta</li>
                    </ul>
                </div>
                <div class="form-group">
                    <label for="confirmDelete">
                        Escribe <strong>"ELIMINAR"</strong> para confirmar:
                    </label>
                    <input type="text" id="confirmDelete" placeholder="Escribe ELIMINAR" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; margin-top: 0.5rem;">
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button id="confirmDeleteBtn" class="btn btn-danger" disabled style="flex: 1;">
                        S√≠, Eliminar Mi Cuenta
                    </button>
                    <button id="cancelDeleteBtn" class="btn btn-secondary" style="flex: 1;">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Favorites Modal -->
    <div id="favoritesModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h2 style="margin: 0; display: flex; align-items: center; gap: 12px;">
                    <span>‚≠ê</span>
                    Mis Favoritos
                </h2>
                <button id="closeFavoritesModal" class="modal-close" style="color: white; opacity: 0.9;">&times;</button>
            </div>
            <div id="favoritesContent" style="padding: 1.5rem; max-height: 500px; overflow-y: auto;">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">No tienes favoritos guardados</p>
                    <p style="font-size: 0.9rem;">Explora Surlink y guarda tus listados favoritos</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Comments Modal -->
    <div id="commentsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h2 style="margin: 0; display: flex; align-items: center; gap: 12px;">
                    <span>üí¨</span>
                    Mis Comentarios
                </h2>
                <button id="closeCommentsModal" class="modal-close" style="color: white; opacity: 0.9;">&times;</button>
            </div>
            <div id="commentsContent" style="padding: 1.5rem; max-height: 500px; overflow-y: auto;">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">No has realizado comentarios</p>
                    <p style="font-size: 0.9rem;">Comenta en listados de Surlink para compartir tu opini√≥n</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Responses Modal -->
    <div id="responsesModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h2 style="margin: 0; display: flex; align-items: center; gap: 12px;">
                    <span>‚Ü©Ô∏è</span>
                    Respuestas Recibidas
                </h2>
                <button id="closeResponsesModal" class="modal-close" style="color: white; opacity: 0.9;">&times;</button>
            </div>
            <div id="responsesContent" style="padding: 1.5rem; max-height: 500px; overflow-y: auto;">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 11 12 14 22 4"></polyline>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                    </svg>
                    <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">No tienes respuestas</p>
                    <p style="font-size: 0.9rem;">Las respuestas a tus comentarios aparecer√°n aqu√≠</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Photo Modal -->
    <div id="uploadPhotoModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üì∑ Cambiar Foto de Perfil</h2>
                <button id="closeUploadPhotoModal" class="modal-close">&times;</button>
            </div>
            <div style="padding: 1.5rem;">
                <div style="margin-bottom: 1.5rem;">
                    <label for="photoInput" style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 500;">
                        Seleccionar foto:
                    </label>
                    <input type="file" id="photoInput" accept="image/jpeg,image/jpg,image/png,image/webp" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                    <small style="color: #666; display: block; margin-top: 0.5rem;">
                        Formatos permitidos: JPG, PNG, WEBP. M√°ximo 5MB.
                    </small>
                </div>

                <!-- Preview -->
                <div id="photoPreviewContainer" style="display: none; margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 500;">
                        Vista previa:
                    </label>
                    <div style="display: flex; justify-content: center;">
                        <div style="width: 150px; height: 150px; border-radius: 50%; overflow: hidden; border: 3px solid #667eea; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <img id="photoPreview" src="" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem;">
                    <button id="confirmUploadBtn" class="btn btn-primary" style="flex: 1;" disabled>
                        Guardar Foto
                    </button>
                    <button id="cancelUploadBtn" class="btn btn-secondary" style="flex: 1;">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <%- include('partials/footer') %>

    <script src="/js/perfil.js"></script>
</body>
</html>
