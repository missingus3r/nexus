<script>
    (function () {
        var theme = 'light';
        try {
            // Try to read from PreferencesService storage (austra_guest_preferences)
            var guestPrefs = localStorage.getItem('austra_guest_preferences');
            if (guestPrefs) {
                var prefs = JSON.parse(guestPrefs);
                var storedTheme = prefs?.ui?.theme;
                if (storedTheme === 'dark' || storedTheme === 'light') {
                    theme = storedTheme;
                } else if (storedTheme !== 'auto' && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    theme = 'dark';
                }
            } else {
                // Fallback: check old austra-theme key for backwards compatibility
                var oldTheme = localStorage.getItem('austra-theme');
                if (oldTheme === 'dark' || oldTheme === 'light') {
                    theme = oldTheme;
                    // Migrate to new format
                    var newPrefs = {
                        favorites: { construccion: [], academy: [], financial: [], listings: [] },
                        navigation: {},
                        welcomeModals: {},
                        ui: { theme: oldTheme }
                    };
                    localStorage.setItem('austra_guest_preferences', JSON.stringify(newPrefs));
                    localStorage.removeItem('austra-theme');
                } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    theme = 'dark';
                }
            }
        } catch (error) {
            // localStorage might be unavailable (e.g. Safari private mode)
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                theme = 'dark';
            }
        }

        var root = document.documentElement;
        root.setAttribute('data-theme', theme);
        root.classList.toggle('dark-mode', theme === 'dark');
        root.classList.toggle('light-mode', theme !== 'dark');
    })();
</script>
<script src="/js/notifications.js" defer></script>
