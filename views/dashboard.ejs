<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <%- include('partials/theme-init') %>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <script src="/js/theme-toggle.js" defer></script>
</head>
<body>
    <%- include('partials/header', { page: 'dashboard', isAuthenticated: isAuthenticated }) %>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <div>
                <h1>Bienvenido a Vortex</h1>
                <p style="color: var(--text-secondary); margin-top: 0.5rem;">Tu resumen de actividad reciente</p>
            </div>
            <div class="user-info">
                <img id="userAvatar" class="user-avatar" src="" alt="Avatar">
                <div class="user-details">
                    <h3 id="userName">Cargando...</h3>
                    <p id="userEmail">usuario@ejemplo.com</p>
                </div>
                <button class="notifications-btn" onclick="openNotificationsModal()">
                    üîî
                    <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                </button>
            </div>
        </div>

        <section class="dashboard-insights">
            <div class="insight-card">
                <header>
                    <span class="icon">üïí</span>
                    <h3>Fecha y Hora</h3>
                </header>
                <p class="insight-value">Martes, 04 de febrero ¬∑ 14:37</p>
                <p class="insight-meta">Montevideo (UTC-3)</p>
            </div>
            <div class="insight-card">
                <header>
                    <span class="icon">üå¶Ô∏è</span>
                    <h3>Clima Actual</h3>
                </header>
                <p class="insight-value">26¬∞C ¬∑ Parcialmente nublado</p>
                <p class="insight-meta">Sensaci√≥n t√©rmica 27¬∞C ¬∑ Viento 12 km/h</p>
            </div>
            <div class="insight-card">
                <header>
                    <span class="icon">üí±</span>
                    <h3>Divisas</h3>
                </header>
                <ul class="insight-list" id="currencyRates">
                    <li>USD <strong id="usdValue">42,80 UYU</strong></li>
                    <li>EUR <strong id="eurValue">46,10 UYU</strong></li>
                    <li>ARS <strong id="arsValue">0,045 UYU</strong></li>
                    <li>BRL <strong id="brlValue">8,25 UYU</strong></li>
                    <li>UI <strong id="uiValue">5,8247 UYU</strong></li>
                    <li>UR <strong id="urValue">4.765,32 UYU</strong></li>
                </ul>
                <button class="insight-btn" onclick="openCurrencyModal()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.25rem;">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 6v6l4 2"></path>
                    </svg>
                    Convertir divisas
                </button>
            </div>
            <div class="insight-card">
                <header>
                    <span class="icon">‚Çø</span>
                    <h3>Bitcoin</h3>
                </header>
                <p class="insight-value">USD 42.580</p>
                <p class="insight-meta">Cambio 24h: <span class="positive">+2.6%</span></p>
            </div>
            <div class="insight-card donation-insight-card">
                <header>
                    <span class="icon">üíù</span>
                    <h3>Apoya Vortex</h3>
                </header>
                <p class="insight-value">Tu donaci√≥n hace la diferencia</p>
                <p class="insight-meta" style="margin-bottom: 0.5rem;">Ayuda a mantener la plataforma gratuita y en constante mejora</p>
                <p class="insight-meta" style="margin-bottom: 1rem; font-size: 0.8rem; opacity: 0.8;">Aparece en el muro (actualizado semanalmente)</p>
                <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: auto;">
                    <a href="https://paypal.me/xplice?locale.x=es_XC&country.x=UY"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="donation-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                            <path d="M2 17l10 5 10-5"></path>
                            <path d="M2 12l10 5 10-5"></path>
                        </svg>
                        Donar con PayPal
                    </a>
                    <a href="/donadores" class="donors-link">Ver muro de donadores ‚Üí</a>
                </div>
            </div>
        </section>

        <div class="dashboard-grid">
            <!-- Centinel Alerts Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2><span class="icon">üö®</span> Alertas de Centinel</h2>
                    <a href="/centinel" class="view-all-btn">Ver todas</a>
                </div>
                <div class="item-list" id="centinelList">
                    <div class="loading">Cargando alertas...</div>
                </div>
            </div>

            <!-- Surlink Posts Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2><span class="icon">üè†</span> Nuevos en Surlink</h2>
                    <a href="/surlink" class="view-all-btn">Ver todas</a>
                </div>
                <div class="item-list" id="surlinkList">
                    <div class="loading">Cargando publicaciones...</div>
                </div>
            </div>

            <!-- Forum Threads Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2><span class="icon">üí¨</span> Foro Vortex</h2>
                    <a href="/forum-vortex" class="view-all-btn">Ver todas</a>
                </div>
                <div class="item-list" id="forumList">
                    <div class="loading">Cargando discusiones...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîî Notificaciones</h2>
                <button class="close-btn" onclick="closeNotificationsModal()">√ó</button>
            </div>
            <div id="notificationsList">
                <div class="loading">Cargando notificaciones...</div>
            </div>
            <button class="mark-all-read-btn" onclick="markAllAsRead()">Marcar todas como le√≠das</button>
        </div>
    </div>

    <!-- Currency Conversion Modal -->
    <div id="currencyModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üí± Convertir Divisas</h2>
                <button class="close-btn" onclick="closeCurrencyModal()">√ó</button>
            </div>
            <div style="padding: 1.5rem;">
                <div class="currency-converter">
                    <div class="converter-input-group">
                        <label for="fromAmount">Cantidad</label>
                        <input type="number" id="fromAmount" class="converter-input" placeholder="0.00" value="1" min="0" step="0.01">
                    </div>

                    <div class="converter-select-group">
                        <label for="fromCurrency">De</label>
                        <select id="fromCurrency" class="converter-select">
                            <option value="USD">USD - D√≥lar Estadounidense</option>
                            <option value="EUR">EUR - Euro</option>
                            <option value="ARS">ARS - Peso Argentino</option>
                            <option value="BRL">BRL - Real Brasile√±o</option>
                            <option value="UYU" selected>UYU - Peso Uruguayo</option>
                            <option value="UI">UI - Unidad Indexada</option>
                            <option value="UR">UR - Unidad Reajustable</option>
                        </select>
                    </div>

                    <div style="text-align: center; margin: 1rem 0;">
                        <button class="swap-btn" onclick="swapCurrencies()" title="Intercambiar">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <polyline points="19 12 12 19 5 12"></polyline>
                            </svg>
                        </button>
                    </div>

                    <div class="converter-select-group">
                        <label for="toCurrency">A</label>
                        <select id="toCurrency" class="converter-select">
                            <option value="USD" selected>USD - D√≥lar Estadounidense</option>
                            <option value="EUR">EUR - Euro</option>
                            <option value="ARS">ARS - Peso Argentino</option>
                            <option value="BRL">BRL - Real Brasile√±o</option>
                            <option value="UYU">UYU - Peso Uruguayo</option>
                            <option value="UI">UI - Unidad Indexada</option>
                            <option value="UR">UR - Unidad Reajustable</option>
                        </select>
                    </div>

                    <div class="converter-result">
                        <div class="result-label">Resultado</div>
                        <div class="result-value" id="conversionResult">0.00</div>
                        <div class="result-rate" id="conversionRate">1 UYU = 0.0234 USD</div>
                    </div>

                    <div class="converter-info">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <span>Tasas de referencia - Actualizado: <span id="ratesUpdateTime">hoy</span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <%- include('partials/footer') %>

    <script src="/js/dashboard.js"></script>
</body>
</html>
