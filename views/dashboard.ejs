<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <%- include('partials/theme-init') %>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <script src="/js/preferences-service.js"></script>
    <script src="/js/theme-toggle.js" defer></script>
</head>
<body>
    <%- include('partials/header', { page: 'dashboard', isAuthenticated: isAuthenticated }) %>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <div>
                <h1>Bienvenido a Austra</h1>
                <p style="color: var(--text-secondary); margin-top: 0.5rem;">Tu resumen de actividad reciente</p>
            </div>
            <div class="user-info">
                <div class="avatar-container">
                    <img id="userAvatar" class="user-avatar" src="" alt="Avatar">
                    <div class="avatar-spinner" id="avatarSpinner">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="user-details">
                    <h3 id="userName">Cargando...</h3>
                    <p id="userEmail">usuario@ejemplo.com</p>
                </div>
                <button class="notifications-btn" onclick="openNotificationsModal()">
                    üîî
                    <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                </button>
            </div>
        </div>

        <div class="dashboard-info-bars">
            <div class="dashboard-datetime-bar">
                <span class="datetime-icon">üïí</span>
                <span id="currentDateTime">Cargando...</span>
                <span class="datetime-separator">‚Ä¢</span>
                <span id="timezoneInfo">Montevideo (UTC-3)</span>
                <span class="datetime-separator">‚Ä¢</span>
                <span id="weekInfo">Semana: --</span>
            </div>

            <div class="dashboard-weather-bar">
                <span id="weatherIcon">üå¶Ô∏è</span>
                <span id="currentWeather">Cargando clima...</span>
                <span class="weather-separator">‚Ä¢</span>
                <span id="weatherMeta">Montevideo, Uruguay</span>
            </div>
        </div>

        <section class="dashboard-insights">
            <div class="insight-card">
                <header>
                    <span class="icon">üí±</span>
                    <h3>Divisas</h3>
                </header>
                <ul class="insight-list currency-grid" id="currencyRates">
                    <li>USD <strong id="usdValue">Cargando...</strong></li>
                    <li>EUR <strong id="eurValue">Cargando...</strong></li>
                    <li>ARS <strong id="arsValue">Cargando...</strong></li>
                    <li>BRL <strong id="brlValue">Cargando...</strong></li>
                    <li>GBP <strong id="gbpValue">Cargando...</strong></li>
                    <li>CHF <strong id="chfValue">Cargando...</strong></li>
                    <li>UI <strong id="uiValue">Cargando...</strong></li>
                    <li>UR <strong id="urValue">Cargando...</strong></li>
                </ul>
                <p class="insight-meta" id="bcuUpdateTime" style="margin-top: 0.75rem; font-size: 0.7rem;">√öltima actualizaci√≥n: --</p>
                <p class="insight-meta" id="bcuError" style="color: #dc2626; margin-top: 0.25rem; display: none; font-size: 0.7rem;"></p>
                <button class="insight-btn" onclick="openCurrencyModal()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.25rem;">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 6v6l4 2"></path>
                    </svg>
                    Convertir divisas
                </button>
                <p class="insight-meta card-footer">
                    Datos de <a href="https://www.brou.com.uy/cotizaciones" target="_blank" rel="noopener noreferrer" style="color: var(--primary-color); text-decoration: underline;">BROU</a> / <a href="https://www.bcu.gub.uy/Estadisticas-e-Indicadores/Paginas/Cotizaciones.aspx" target="_blank" rel="noopener noreferrer" style="color: var(--primary-color); text-decoration: underline;">BCU</a>
                </p>
            </div>
            <div class="insight-card">
                <header>
                    <span class="icon">‚Çø</span>
                    <h3>Bitcoin</h3>
                </header>
                <div style="flex: 1;">
                    <p class="insight-value" id="bitcoinPrice">Cargando...</p>
                    <p class="insight-meta" id="bitcoinChange">Cambio 15s: --</p>
                </div>
                <p class="insight-meta card-footer">
                    Datos de <a href="https://www.coingecko.com" target="_blank" rel="noopener noreferrer" style="color: var(--primary-color); text-decoration: underline;">CoinGecko</a>
                </p>
            </div>
            <div class="insight-card" id="creditProfileCard">
                <header>
                    <span class="icon">üí≥</span>
                    <h3>Perfil Crediticio</h3>
                </header>
                <div id="creditProfileContent">
                    <p class="insight-meta" style="text-align: center; padding: 1rem;">Cargando...</p>
                </div>
            </div>
            <div class="insight-card" id="cvCard">
                <header>
                    <span class="icon">üìÑ</span>
                    <h3>Mi CV</h3>
                </header>
                <div id="cvContent">
                    <p class="insight-meta" style="text-align: center; padding: 1rem;">Cargando...</p>
                </div>
            </div>
        </section>

        <div class="dashboard-donation-bar">
            <div class="donation-content">
                <div class="donation-info">
                    <span class="donation-icon">üíù</span>
                    <div>
                        <h3>Apoya Austra</h3>
                        <p>Tu donaci√≥n ayuda a mantener la plataforma gratuita y en constante mejora</p>
                    </div>
                </div>
                <div class="donation-actions">
                    <a href="https://paypal.me/xplice?locale.x=es_XC&country.x=UY"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="donation-btn-bar">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                            <path d="M2 17l10 5 10-5"></path>
                            <path d="M2 12l10 5 10-5"></path>
                        </svg>
                        Donar con PayPal
                    </a>
                    <a href="/donadores" class="donors-link-bar">Ver muro ‚Üí</a>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Centinel Alerts Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2><span class="icon">üö®</span> Alertas de Centinel</h2>
                </div>
                <div class="item-list" id="centinelList">
                    <div class="loading">Cargando alertas...</div>
                </div>
                <a href="/centinel" class="view-all-btn">Ver todas</a>
            </div>

            <!-- Surlink Posts Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2><span class="icon">üè†</span> Nuevos en Surlink</h2>
                </div>
                <div class="item-list" id="surlinkList">
                    <div class="empty-state">
                        <div class="icon">üöß</div>
                        <p>Pr√≥ximamente</p>
                    </div>
                </div>
                <a href="/surlink" class="view-all-btn">Ver todas</a>
            </div>

            <!-- Forum Threads Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2><span class="icon">üí¨</span> Foro Austra</h2>
                </div>
                <div class="item-list" id="forumList">
                    <div class="loading">Cargando discusiones...</div>
                </div>
                <a href="/forum-austra" class="view-all-btn">Ver todas</a>
            </div>
        </div>

        <div class="dashboard-coming-soon-bar">
            <div class="coming-soon-content">
                <div class="coming-soon-header">
                    <span class="coming-soon-icon">üöÄ</span>
                    <h3>Pr√≥ximamente en Austra</h3>
                </div>
                <div class="coming-soon-grid">
                    <div class="coming-soon-item">
                        <span class="item-icon">üíº</span>
                        <strong>Ofertas laborales</strong>
                    </div>
                    <div class="coming-soon-item">
                        <span class="item-icon">üìÑ</span>
                        <strong>Facturaci√≥n electr√≥nica</strong>
                    </div>
                    <div class="coming-soon-item">
                        <span class="item-icon">üêæ</span>
                        <strong>Publicar adopciones y rescates</strong>
                    </div>
                    <div class="coming-soon-item">
                        <span class="item-icon">üíù</span>
                        <strong>Campa√±as solidarias</strong>
                    </div>
                    <div class="coming-soon-item">
                        <span class="item-icon">üîç</span>
                        <strong>Perdidos y encontrados</strong>
                    </div>
                    <div class="coming-soon-item">
                        <span class="item-icon">üè†</span>
                        <strong>Surlink expandido (autos y casas)</strong>
                    </div>
                    <div class="coming-soon-item">
                        <span class="item-icon">üöó</span>
                        <strong>Consulta de patentes</strong>
                    </div>
                    <div class="coming-soon-item">
                        <span class="item-icon">ü§ñ</span>
                        <strong>Chatbot con GPT-5</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîî Notificaciones</h2>
                <button class="close-btn" onclick="closeNotificationsModal()">√ó</button>
            </div>
            <div id="notificationsList">
                <div class="loading">Cargando notificaciones...</div>
            </div>
            <button class="mark-all-read-btn" onclick="markAllAsRead()">Marcar todas como le√≠das</button>
        </div>
    </div>

    <!-- Currency Conversion Modal -->
    <div id="currencyModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üí± Convertir Divisas</h2>
                <button class="close-btn" onclick="closeCurrencyModal()">√ó</button>
            </div>
            <div style="padding: 1.5rem;">
                <div class="currency-converter">
                    <div class="converter-input-group">
                        <label for="fromAmount">Cantidad</label>
                        <input type="number" id="fromAmount" class="converter-input" placeholder="0.00" value="1" min="0" step="0.01">
                    </div>

                    <div class="converter-select-group">
                        <label for="fromCurrency">De</label>
                        <select id="fromCurrency" class="converter-select">
                            <option value="USD">USD - D√≥lar Estadounidense</option>
                            <option value="EUR">EUR - Euro</option>
                            <option value="ARS">ARS - Peso Argentino</option>
                            <option value="BRL">BRL - Real Brasile√±o</option>
                            <option value="GBP">GBP - Libra Esterlina</option>
                            <option value="CHF">CHF - Franco Suizo</option>
                            <option value="BTC">BTC - Bitcoin</option>
                            <option value="UYU" selected>UYU - Peso Uruguayo</option>
                            <option value="UI">UI - Unidad Indexada</option>
                            <option value="UR">UR - Unidad Reajustable</option>
                        </select>
                    </div>

                    <div style="text-align: center; margin: 1rem 0;">
                        <button class="swap-btn" onclick="swapCurrencies()" title="Intercambiar">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <polyline points="19 12 12 19 5 12"></polyline>
                            </svg>
                        </button>
                    </div>

                    <div class="converter-select-group">
                        <label for="toCurrency">A</label>
                        <select id="toCurrency" class="converter-select">
                            <option value="USD" selected>USD - D√≥lar Estadounidense</option>
                            <option value="EUR">EUR - Euro</option>
                            <option value="ARS">ARS - Peso Argentino</option>
                            <option value="BRL">BRL - Real Brasile√±o</option>
                            <option value="GBP">GBP - Libra Esterlina</option>
                            <option value="CHF">CHF - Franco Suizo</option>
                            <option value="BTC">BTC - Bitcoin</option>
                            <option value="UYU">UYU - Peso Uruguayo</option>
                            <option value="UI">UI - Unidad Indexada</option>
                            <option value="UR">UR - Unidad Reajustable</option>
                        </select>
                    </div>

                    <div class="converter-result">
                        <div class="result-label">Resultado</div>
                        <div class="result-value" id="conversionResult">0.00</div>
                        <div class="result-rate" id="conversionRate">1 UYU = 0.0234 USD</div>
                    </div>

                    <div class="converter-info">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <span>Tasas de referencia - Actualizado: <span id="ratesUpdateTime">hoy</span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <%- include('partials/footer') %>

    <script src="/js/dashboard.js"></script>
</body>
</html>
